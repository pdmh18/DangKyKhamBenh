@model DangKyKhamBenh.Models.TaiKhoan
@{
    Layout = null;                // không dùng layout
    ViewBag.Title = "Đăng ký";    // tiêu đề trang

    // nhận cờ/thông điệp từ TempData (được map sang ViewBag ở GET Register)
    var pendingOk = (ViewBag.PendingOk as bool?) == true;
    var pendingMsg = ViewBag.PendingMsg as string;
    var pendingPhone = ViewBag.PendingPhone as string;
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />

    <style>
        :root {
            --pri: #16a34a;
            --pri-dark: #0f7a35;
        }

        body {
            min-height: 100vh;
            background: radial-gradient(1200px 800px at 20% 10%, #e8f7ee 0%, transparent 50%), radial-gradient(900px 700px at 100% 0, #f0fff4 0%, transparent 55%), linear-gradient(180deg, #f8fbf9 0%, #eef6f1 100%);
        }

        .auth-card {
            max-width: 880px;
            border: 0;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,.12);
        }

        .auth-header {
            background: linear-gradient(135deg,var(--pri) 0%,#22c55e 100%);
            color: #fff;
            padding: 28px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 22px;
            letter-spacing: .3px;
        }

            .brand .logo {
                width: 40px;
                height: 40px;
                border-radius: 10px;
                background: rgba(255,255,255,.15);
                display: grid;
                place-items: center;
            }

        .auth-body {
            padding: 28px;
            background: #fff;
        }

        .form-label {
            font-weight: 600;
        }

        .form-control, .form-select {
            border-radius: 10px;
            padding: .65rem .75rem;
            border: 1px solid #e4e7ec;
            transition: all .2s ease;
        }

            .form-control:focus, .form-select:focus {
                border-color: var(--pri);
                box-shadow: 0 0 0 .2rem rgba(22,163,74,.15);
            }

        .input-icon {
            position: relative;
        }

            .input-icon .fa, .input-icon .fas, .input-icon .far, .input-icon .fa-solid {
                position: absolute;
                left: 14px;
                top: 50%;
                transform: translateY(-50%);
                opacity: .6;
            }

            .input-icon input, .input-icon select {
                padding-left: 40px;
            }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            border: 0;
            background: transparent;
            color: #6b7280;
        }

        .btn-success {
            background: var(--pri);
            border-color: var(--pri);
            border-radius: 12px;
            font-weight: 700;
            padding: .8rem 1rem;
        }

            .btn-success:hover {
                background: var(--pri-dark);
                border-color: var(--pri-dark);
            }

        .small-muted {
            color: #6b7280;
            font-size: .9rem;
        }

        .divider {
            height: 1px;
            background: #eef2f7;
            margin: 10px 0 2px;
        }

        @@media (max-width:576px) {
            .auth-header {
                padding: 20px
            }

            .auth-body {
                padding: 20px
            }
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="mx-auto auth-card">
            <!-- Header -->
            <div class="auth-header">
                <div class="brand">
                    <div class="logo"><i class="fa-solid fa-user-plus"></i></div>
                    Đăng ký tài khoản
                </div>
                <div class="small-muted mt-2">Tạo tài khoản để đặt lịch khám nhanh chóng và theo dõi hồ sơ sức khỏe.</div>
            </div>

            <!-- Body -->
            <div class="auth-body">

                @* Nếu đã gửi yêu cầu thành công: hiện thông báo & nút điều hướng *@
                @if (pendingOk)
                {
                    <div class="alert alert-success" role="alert">
                        <div class="d-flex align-items-start gap-2">
                            <i class="fa-solid fa-circle-check mt-1"></i>
                            <div>
                                <div class="fw-bold">Yêu cầu đăng ký đã được gửi</div>
                                <div>
                                    @(string.IsNullOrWhiteSpace(pendingMsg)
                                    ? "Tài khoản của bạn phải chờ xác minh. Khi xác minh xong, chúng tôi sẽ gửi thông báo về số điện thoại bạn đã cung cấp."
                                    : pendingMsg)
                                </div>
                                @if (!string.IsNullOrWhiteSpace(pendingPhone))
                                {
                                    <div class="text-muted mt-1">Số nhận thông báo: <strong>@pendingPhone</strong></div>
                                }
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-2 mb-3">
                        <a class="btn btn-success" href="@Url.Action("Login","Account")"><i class="fa-solid fa-right-to-bracket me-1"></i> Đến trang đăng nhập</a>
                        <a class="btn btn-outline-secondary" href="@Url.Action("Index","Home")">Về trang chủ</a>
                    </div>
                }

                @using (Html.BeginForm("Register", "Account", FormMethod.Post, new { @class = "needs-validation", novalidate = "novalidate", id = "frmRegister" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary(true, "", new { @class = "text-danger mb-2" })

                    @* Force: Bệnh nhân + USER *@
                    <input type="hidden" name="StaffType" value="BenhNhan" />
                    <input type="hidden" name="Role" value="USER" />

                    <div class="row g-3">
                        <div class="col-md-6">
                            @Html.LabelFor(m => m.Username, new { @class = "form-label" })
                            <div class="input-icon">
                                <i class="fa-solid fa-user"></i>
                                @Html.TextBoxFor(m => m.Username, new { placeholder = "Nhập tên đăng nhập", @class = "form-control", autocomplete = "username" })
                            </div>
                            @Html.ValidationMessageFor(m => m.Username, "", new { @class = "text-danger" })
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            <div class="input-icon">
                                <i class="fa-solid fa-envelope"></i>
                                <input name="Email" type="email" class="form-control" placeholder="you@example.com" autocomplete="email" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            @Html.LabelFor(m => m.Password, new { @class = "form-label" })
                            <div class="input-icon">
                                <i class="fa-solid fa-lock"></i>
                                @Html.PasswordFor(m => m.Password, new { placeholder = "Mật khẩu", @class = "form-control", id = "Password" })
                                <button type="button" class="password-toggle" onclick="togglePwd('Password', this)" aria-label="Hiện/ẩn mật khẩu">
                                    <i class="fa-regular fa-eye"></i>
                                </button>
                            </div>
                            @Html.ValidationMessageFor(m => m.Password, "", new { @class = "text-danger" })
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Xác nhận mật khẩu</label>
                            <div class="input-icon">
                                <i class="fa-solid fa-key"></i>
                                <input name="ConfirmPassword" id="ConfirmPassword" type="password" class="form-control" placeholder="Nhập lại mật khẩu" />
                                <button type="button" class="password-toggle" onclick="togglePwd('ConfirmPassword', this)" aria-label="Hiện/ẩn mật khẩu">
                                    <i class="fa-regular fa-eye"></i>
                                </button>
                            </div>
                            <div class="small text-danger" id="cpwMsg" style="display:none;">Mật khẩu xác nhận không khớp.</div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Số điện thoại</label>
                            <div class="input-icon">
                                <i class="fa-solid fa-phone"></i>
                                <input name="PhoneNumber" class="form-control" placeholder="090..." autocomplete="tel" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Ngày sinh</label>
                            <div class="input-icon">
                                <i class="fa-regular fa-calendar"></i>
                                <input name="DateOfBirth" type="date" class="form-control" />
                            </div>
                        </div>

                        <div class="col-md-12">
                            <label class="form-label">Địa chỉ</label>
                            <div class="input-icon">
                                <i class="fa-solid fa-location-dot"></i>
                                <input name="Address" class="form-control" placeholder="Số nhà, đường, phường/xã, quận/huyện, tỉnh/thành" />
                            </div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <button type="submit" class="btn btn-success w-100 mt-2">
                        <i class="fa-solid fa-user-plus me-2"></i>Đăng ký
                    </button>

                    <div class="d-flex justify-content-between mt-3">
                        <small class="small-muted">Bằng việc đăng ký, bạn đồng ý với Điều khoản &amp; Chính sách.</small>
                        <a href="@Url.Action("Login","Account")" class="small">Đã có tài khoản? Đăng nhập</a>
                    </div>
                }

            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
    function togglePwd(id, btn) {
        const input = document.getElementById(id);
        const icon = btn.querySelector('i');
        if (!input) return;
        input.type = input.type === 'password' ? 'text' : 'password';
        icon.classList.toggle('fa-eye');
        icon.classList.toggle('fa-eye-slash');
    }

    // cảnh báo confirm password realtime
    const pw = document.getElementById('Password');
    const cpw = document.getElementById('ConfirmPassword');
    const msg = document.getElementById('cpwMsg');
    function checkMatch() {
        if (!pw || !cpw || !msg) return;
        msg.style.display = (cpw.value.length > 0 && pw.value !== cpw.value) ? 'block' : 'none';
    }
    if (pw && cpw) { pw.addEventListener('input', checkMatch); cpw.addEventListener('input', checkMatch); }

    // nếu pendingOk=true thì ẩn form (tránh user nghĩ chưa gửi)
    @if (pendingOk) {
        @:document.addEventListener('DOMContentLoaded', function(){ var f=document.getElementById('frmRegister'); if(f) f.style.display='none'; });
    }
    </script>
</body>
</html>
