@model DangKyKhamBenh.Models.ViewModels.ChonNgayKhamVM
@{
    Layout = null;
    var firstDay = new DateTime(Model.Year, Model.Month, 1);
    int daysInMonth = DateTime.DaysInMonth(Model.Year, Model.Month);
    int startOffset = (int)firstDay.DayOfWeek;

    var prevMonth = firstDay.AddMonths(-1);
    var nextMonth = firstDay.AddMonths(1);
}
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>ChonNgayKham</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
        body {
            background: #eef2f7;
            font-family: 'Segoe UI', sans-serif;
        }

        .calendar-card {
            margin: 25px auto;
            max-width: 430px;
            background: #fff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.08);
        }

        /* Header */
        .page-title {
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        /* Day cells */
        .day-cell {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 3px;
            font-size: 15px;
            transition: 0.15s;
        }

        .day-disabled {
            background: #e9ecef;
            color: #b3b7bb;
        }

        .day-selectable {
            background: #0d6efd;
            color: #fff;
            border: none;
        }

            .day-selectable:hover {
                background: #0b5ed7;
                transform: scale(1.05);
            }

        .day-today {
            background: #fff;
            color: #0d6efd;
            border: 2px solid #0d6efd;
            font-weight: 600;
        }

        .weekday-header {
            font-size: 13px;
            font-weight: 600;
            color: #6c757d;
            text-align: center;
        }

        /* Month switch buttons */
        .month-btn {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            border: 1px solid #d0d7de;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: .2s;
        }

            .month-btn:hover {
                background: #f3f4f6;
            }

        /* Legend */
        .legend-square {
            width: 15px;
            height: 15px;
            border-radius: 4px;
            display: inline-block;
            margin-right: 6px;
        }

        .legend-selectable {
            background: #0d6efd;
        }

        .legend-disabled {
            background: #d6d8da;
        }

        .legend-holiday {
            border: 2px solid #ff6b35;
        }
    </style>
</head>

<body>
    <div class="calendar-card">

        <!-- Title + Back -->
        <div class="d-flex align-items-center mb-3">
            <a href="javascript:history.back()" class="me-3 text-decoration-none fs-5">&larr;</a>
            <h5 class="mb-0 page-title">Chọn ngày khám</h5>
        </div>

        <!-- Month header -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <a class="month-btn"
               href="@Url.Action("ChonNgayKham", "DangKyKham",
                    new { dvId = Model.DV_MaDichVu, year = prevMonth.Year, month = prevMonth.Month })">
                &lt;
            </a>

            <div class="fw-semibold fs-5">
                Tháng @Model.Month / @Model.Year
            </div>

            <a class="month-btn"
               href="@Url.Action("ChonNgayKham", "DangKyKham",
                    new { dvId = Model.DV_MaDichVu, year = nextMonth.Year, month = nextMonth.Month })">
                &gt;
            </a>
        </div>

        <!-- Weekday headers -->
        <div class="d-flex justify-content-between mb-2">
            <div class="flex-fill weekday-header">CN</div>
            <div class="flex-fill weekday-header">T2</div>
            <div class="flex-fill weekday-header">T3</div>
            <div class="flex-fill weekday-header">T4</div>
            <div class="flex-fill weekday-header">T5</div>
            <div class="flex-fill weekday-header">T6</div>
            <div class="flex-fill weekday-header">T7</div>
        </div>

        <!-- Calendar -->
        @{
            int day = 1;
            while (day <= daysInMonth)
            {
                <div class="d-flex justify-content-between">
                    @for (int dow = 0; dow < 7; dow++)
                    {
                        if (day == 1 && dow < startOffset)
                        {
                            <div class="day-cell day-disabled"></div>
                        }
                        else if (day > daysInMonth)
                        {
                            <div class="day-cell day-disabled"></div>
                        }
                        else
                        {
                            var date = new DateTime(Model.Year, Model.Month, day);
                            var item = Model.Days.First(x => x.Date == date);

                            if (!item.IsSelectable)
                            {
                                <div class="day-cell day-disabled">@day</div>
                            }
                            else
                            {
                                using (Html.BeginForm("XacNhanNgayKham", "DangKyKham", FormMethod.Post))
                                {
                                    @Html.AntiForgeryToken()
                                    @Html.Hidden("dvId", Model.DV_MaDichVu)
                                    @Html.Hidden("ngayKham", date.ToString("yyyy-MM-dd"))

                                    var css = item.IsToday ? "day-cell day-today" : "day-cell day-selectable";

                                    <button type="submit" class="@css">@day</button>
                                }
                            }

                            day++;
                        }
                    }
                </div>
            }
        }

        <!-- Legend -->
        <div class="mt-4">
            <p class="small text-muted">
                Chọn các ngày có <span class="text-primary fw-bold">màu xanh dương</span> để đặt khám.
            </p>

            <div class="small">
                <div class="mb-1"><span class="legend-square legend-selectable"></span> Ngày có thể chọn</div>
                <div class="mb-1"><span class="legend-square legend-disabled"></span> Ngày không khả dụng</div>
                <div class="mb-1"><span class="legend-square legend-holiday"></span> Ngày nghỉ / lễ </div>
            </div>
        </div>

    </div>
</body>
</html>
