@model System.Data.DataTable
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewBag.Title = "Lịch sử tài khoản";

    string sortBy = ViewBag.SortBy as string ?? "date";
    string sortDir = ViewBag.SortDir as string ?? "desc";
    string keyword = ViewBag.Keyword as string ?? "";
}
<div style="margin:10px 10px 10px 0">
    <a class="btn btn-outline-secondary" href="@Url.Action("Home","Admin")">←</a>
</div>


<div class="card shadow-sm mb-4">
    <div class="card-body">
        <form method="get" class="row g-3 d-flex align-items-center">
            <div class="col-md-6 align-items-center">
                <h3 class="mb-0 me-3">📜 Lịch sử đăng ký tài khoản</h3>
            </div>
            <div class="col-md-6 d-flex">
                <input type="text"
                       name="keyword"
                       class="form-control"
                       placeholder="Tìm theo username hoặc mã tài khoản..."
                       value="@keyword" />
                <button class="btn btn-primary px-4" style="width:200px">Tìm kiếm</button>
            </div>
        </form>
    </div>
</div>

<!-- Bảng dữ liệu -->
<div class="table-responsive shadow-sm">
    <table class="table table-hover table-bordered align-middle">
        <thead class="table-primary">
            <tr>
                <th class="text-center">Mã TK</th>

                <!-- Sắp xếp Username -->
                <th>
                    <a class="text-decoration-none fw-bold"
                       href="@Url.Action("History", new { keyword = keyword, sortBy = "username", sortDir = sortDir })">
                        Username
                        @if (sortBy == "username")
                        {
                            <span>
                                @(sortDir == "asc" ? "▲" : "▼")
                            </span>
                        }
                    </a>
                </th>

                <th>Loại nhân sự</th>
                <th>Role</th>
                <th>Trạng thái</th>

                <!-- Sắp xếp Ngày tạo -->
                <th>
                    <a class="text-decoration-none fw-bold"
                       href="@Url.Action("History", new { keyword = keyword, sortBy = "date", sortDir = sortDir })">
                        Ngày tạo
                        @if (sortBy == "date")
                        {
                            <span>
                                @(sortDir == "asc" ? "▲" : "▼")
                            </span>
                        }
                    </a>
                </th>
            </tr>
        </thead>

        <tbody>
            @foreach (System.Data.DataRow row in Model.Rows)
            {
                <tr>
                    <td class="text-center">@row["TK_MaTK"]</td>
                    <td>@row["TK_UserName"]</td>
                    <td>@row["TK_StaffType"]</td>
                    <td>@row["TK_Role"]</td>

                    <td>
                        @if (string.Equals(row["TrangThai"].ToString().Trim(), "ACTIVE", StringComparison.OrdinalIgnoreCase))
                        {
                            <span class="btn btn-success btn-sm py-0 px-2">Active</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">@row["TrangThai"]</span>
                        }
                    </td>

                    <td>@String.Format("{0:dd/MM/yyyy HH:mm}", row["TK_NgayTao"])</td>
                </tr>
            }
        </tbody>

    </table>
</div>

